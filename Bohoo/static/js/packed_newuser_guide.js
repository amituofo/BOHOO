Do(function(){function b(){var j=$("#J_JoinedGroupsCount"),e=$("#J_JoinedGroups"),i=j.offset(),h=j.width(),f=j.height(),g=e.height();if(g===0){g=e.show().height();e.hide()}e.css({left:i.left+h+10,top:i.top+f/2-g/2-2})}function d(){var j=$("#J_JoinedGroupsCount"),g=$("#J_JoinedGroups"),i=j.offsetParent(),e,h=100,f=80;i.append(g);b();j.hover(function(k){g.fadeIn(f)},function(k){e=setTimeout(function(){g.fadeOut(f);e=null},h)});g.hover(function(k){if(e){clearTimeout(e);e=null}},function(k){g.fadeOut(f)})}var c='            <li>                <img class="group-avatar" width="24" height="24" src="{PIC_URL}" alt="{NAME}" title="{NAME}">                <span class="group-title" title="{NAME}">{NAME}</span>            </li>        ';function a(){var j=$("#J_GroupCateList"),n=$("#J_GroupsPanel"),i=j.find(".cate-item"),k=n.find(".cate-group-list"),h="active",o=i.index(i.filter("."+h)),e=$("#J_JoinedGroupList"),m=$("#J_JoinedGroupsNum"),q=$("#J_JoinedGroupsCount"),g=$("#J_StartGroup"),f=400,p=2000;i.click(function(r){var s=i.index(this);if(s!==o){i.eq(o).removeClass(h);k.eq(o).removeClass(h);o=s;i.eq(o).addClass(h);k.eq(o).addClass(h)}});function l(r,s){r.fadeOut(f,function(){r.replaceWith(s.css("opacity",0));s.animate({opacity:1},f)})}n.delegate(".btn-join","click",function(t){var v=$(this),u=v.parents(".group-item"),s="/j/group/"+u.data("id"),r=v.text(),w=new Date();v.removeClass("btn-join").addClass("joined").html("&#10004;已加入");$.get(s+"/join",function(D){if(D.result===true){var z=u.find(".group-title"),B=z.attr("title"),y=u.find("img").attr("src"),x=$(c.replace(/\{NAME\}/g,B).replace(/\{PIC_URL\}/g,y)),A=parseInt(m.text(),10),C=[];A=isNaN(A)?0:A;if(A===0){e.find(".nope").remove();g.addClass("active");q.addClass("active")}e.append(x);m.text(++A);if(A<5){b()}u.parent().find(".group-item").each(function(E,F){C.push($(F).data("id"))});$.post_withck(s+"/similar_groups",{gids:C.join("|"),cate:i.eq(o).data("id")},function(F){var E,G,I,H;if((E=F.groups)&&E.length>0){G=$(E[0]);if(u.hasClass("last-line")){G.addClass("last-line")}H=function(){l(u,G)};if((I=new Date()-w-p)<0){setTimeout(H,-I)}else{H()}}else{u.animate({opacity:0},f)}},"json")}else{alert("Oops 加入小组失败，请重试一次。");v.addClass("btn-join").removeClass("joined").text(r)}})});g.click(function(r){if(!$(this).hasClass("active")){r.preventDefault()}})}d();a()});